# Веб-интерфейс RelayBot - Быстрый старт

## Что реализовано

✅ **Трансляция камеры** - видео в реальном времени с камеры робота  
✅ **LiDAR карта** - визуализация данных лидара на Canvas  
✅ **Управление движением** - кнопки и клавиатура (WASD / стрелки)  
✅ **Управление сервоприводом** - слайдер для открытия ящика (0-112°)  
✅ **WebSocket** - обновление LiDAR данных 10 раз в секунду  
✅ **Адаптивный дизайн** - работает на компьютере и телефоне  

## Установка

### 1. Установите зависимости

```bash
# Активируйте виртуальное окружение
source .venv/bin/activate

# Установите Flask и другие библиотеки
pip install Flask flask-socketio python-socketio eventlet opencv-python
```

Или просто:
```bash
pip install -r requirements.txt
```

### 2. Проверьте готовность

```bash
python test_web_setup.py
```

Этот скрипт проверит все зависимости и файлы.

## Запуск

```bash
python run_web_interface.py
```

Откройте в браузере:
- **На роботе**: http://localhost:5000
- **С другого компьютера**: http://<IP_робота>:5000

Например, если IP робота `192.168.1.100`:
```
http://192.168.1.100:5000
```

## Управление

### Клавиатура
- `W` / `↑` - вперед
- `S` / `↓` - назад  
- `A` / `←` - влево
- `D` / `→` - вправо
- `Пробел` - стоп

Робот останавливается автоматически при отпускании клавиш.

### Кнопки на экране
Нажимайте кнопки со стрелками для управления.

### Сервопривод
Двигайте слайдер для открытия/закрытия ящика (0° = закрыт, 112° = открыт).

## Структура файлов

```
web_interface.py              # Flask сервер и API
templates/index.html          # Веб-интерфейс
run_web_interface.py          # Скрипт запуска
test_web_setup.py             # Проверка готовности
WEB_INTERFACE_README.md       # Подробная документация (English)
ВЕБИ_ИНТЕРФЕЙС_ИНСТРУКЦИЯ.md  # Эта инструкция
```

## Что происходит внутри

1. **Flask** запускает веб-сервер на порту 5000
2. **Камера** захватывает кадры и отправляет их как MJPEG стрим
3. **LiDAR** отправляет данные через WebSocket каждые 0.1 секунды
4. **JavaScript** на странице рисует точки LiDAR на Canvas
5. **Кнопки/клавиши** отправляют команды через REST API на Arduino

## Возможные проблемы

### Камера не работает
```bash
# Проверьте, что камера не занята
ls /dev/video*
# Должен быть /dev/video0
```

### LiDAR не отображается
Проверьте подключение:
```bash
ls /dev/ttyUSB*
# Должен быть /dev/ttyUSB0
```

### Робот не двигается
Проверьте Arduino:
```bash
ls /dev/ttyACM*
# Должен быть /dev/ttyACM0
```

### Порт 5000 занят
Измените порт в `run_web_interface.py`:
```python
run_web_interface(host='0.0.0.0', port=8080)
```

## Безопасность

⚠️ Интерфейс доступен из локальной сети (0.0.0.0).

Для доступа только с робота измените в `run_web_interface.py`:
```python
run_web_interface(host='127.0.0.1', port=5000)
```

## Следующие шаги

После тестирования веб-интерфейса можно:
1. Добавить отображение состояния state_machine
2. Добавить кнопки для запуска/остановки автономного режима
3. Добавить логи в реальном времени
4. Добавить график одометрии

Все это можно легко добавить через WebSocket и обновление HTML.

## Вопросы?

Смотрите подробную документацию в `WEB_INTERFACE_README.md` (на английском).
