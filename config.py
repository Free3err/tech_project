# -*- coding: utf-8 -*-
"""
Конфигурация системы RelayBot
Централизованные параметры для всех подсистем
"""

import math

# ============================================================================
# КООРДИНАТЫ ЗОН
# ============================================================================

# Домашняя позиция робота (начало координат)
HOME_POSITION = (0.0, 0.0)

# Зона загрузки склада (координаты в метрах)
WAREHOUSE_ZONE = (5.0, 3.0)

# Радиус зоны доставки (метры)
DELIVERY_ZONE_RADIUS = 3.0

# ============================================================================
# ПАРАМЕТРЫ НАВИГАЦИИ
# ============================================================================

# Допуск позиции для достижения цели (метры)
POSITION_TOLERANCE = 0.1

# Расстояние подхода к клиенту (метры)
CUSTOMER_APPROACH_DISTANCE = 0.5

# Максимальная скорость моторов (0-255)
MAX_SPEED = 150

# Минимальная скорость моторов для движения (0-255)
MIN_SPEED = 50

# Частота обновления локализации (Герц)
LOCALIZATION_UPDATE_RATE = 10

# Частота обновления навигации (Герц)
NAVIGATION_UPDATE_RATE = 10

# Максимальное время застревания перед ошибкой (секунды)
MAX_STUCK_TIME = 30.0

# Порог определения застревания (метры)
STUCK_THRESHOLD = 0.05

# ============================================================================
# ПАРАМЕТРЫ LIDAR
# ============================================================================

# Последовательный порт LiDAR
LIDAR_PORT = '/dev/ttyUSB0'

# Скорость передачи данных LiDAR
LIDAR_BAUDRATE = 230400

# Минимальное количество точек для обнаружения человека
PERSON_DETECTION_MIN_POINTS = 10

# Расстояние кластеризации для обнаружения человека (метры)
PERSON_DETECTION_CLUSTER_DISTANCE = 0.3

# Минимальный размер кластера для человека (метры)
PERSON_MIN_CLUSTER_SIZE = 0.3

# Максимальный размер кластера для человека (метры)
PERSON_MAX_CLUSTER_SIZE = 0.8

# Минимальное расстояние обнаружения препятствий (метры)
OBSTACLE_MIN_DISTANCE = 0.3

# Максимальная дальность LiDAR (метры)
LIDAR_MAX_RANGE = 10.0

# Минимальная дальность LiDAR (метры)
LIDAR_MIN_RANGE = 0.1

# ============================================================================
# ПАРАМЕТРЫ ОДОМЕТРИИ
# ============================================================================

# Расстояние между колесами (метры)
WHEEL_BASE = 0.25

# Радиус колеса (метры)
WHEEL_RADIUS = 0.05

# Количество тиков энкодера на один оборот колеса
ENCODER_TICKS_PER_REVOLUTION = 360

# ============================================================================
# ПАРАМЕТРЫ ПОСЛЕДОВАТЕЛЬНОЙ СВЯЗИ
# ============================================================================

# Порт Arduino (Windows: 'COM10', Linux: '/dev/ttyACM0')
ARDUINO_PORT = 'COM10'

# Скорость передачи данных Arduino
ARDUINO_BAUDRATE = 9600

# Таймаут последовательной связи (секунды)
SERIAL_TIMEOUT = 0.5

# Максимальное количество попыток отправки команды
SERIAL_MAX_RETRIES = 3

# Размер очереди команд
SERIAL_COMMAND_QUEUE_SIZE = 10

# ============================================================================
# ПАРАМЕТРЫ ДОСТАВКИ
# ============================================================================

# Время ожидания забора посылки клиентом (секунды)
DELIVERY_TIMEOUT = 10.0

# Время ожидания загрузки посылки на складе (секунды)
LOADING_CONFIRMATION_TIMEOUT = 60.0

# Время ожидания сканирования QR кода (секунды)
QR_SCAN_TIMEOUT = 30.0

# ============================================================================
# ПАРАМЕТРЫ АУДИО
# ============================================================================

# Директория с аудио файлами
AUDIO_DIR = 'assets/audio'

# Имена аудио файлов
AUDIO_REQUEST_QR = 'request_qr.wav'
AUDIO_ORDER_ACCEPTED = 'order_accepted.wav'
AUDIO_ORDER_REJECTED = 'order_rejected.wav'
AUDIO_DELIVERY_GREETING = 'delivery_greeting.wav'
AUDIO_SUCCESS_SCAN = 'successScan.wav'
AUDIO_FAILURE_SCAN = 'failureScan.wav'
AUDIO_ERROR = 'error.wav'

# ============================================================================
# ПАРАМЕТРЫ БАЗЫ ДАННЫХ
# ============================================================================

# URL базы данных SQLite
DATABASE_URL = "sqlite:///assets/orders.db"

# ============================================================================
# ПАРАМЕТРЫ СЕРВОПРИВОДА (КОРОБКА)
# ============================================================================

# Угол открытой коробки (градусы)
BOX_OPEN_ANGLE = 90

# Угол закрытой коробки (градусы)
BOX_CLOSE_ANGLE = 0

# Скорость движения сервопривода (градусы/секунда)
SERVO_SPEED = 45

# ============================================================================
# ПАРАМЕТРЫ КАРТЫ
# ============================================================================

# Путь к файлу карты окружения
MAP_FILE = 'assets/maps/warehouse_map.yaml'

# Разрешение карты (метры на пиксель)
MAP_RESOLUTION = 0.05

# Размер карты (метры)
MAP_WIDTH = 10.0
MAP_HEIGHT = 10.0

# ============================================================================
# ПАРАМЕТРЫ ФИЛЬТРА ЧАСТИЦ (ЛОКАЛИЗАЦИЯ)
# ============================================================================

# Количество частиц для локализации
NUM_PARTICLES = 200

# Шум движения (стандартное отклонение)
MOTION_NOISE_TRANSLATION = 0.02  # метры
MOTION_NOISE_ROTATION = 0.05     # радианы

# Шум измерения LiDAR (стандартное отклонение)
MEASUREMENT_NOISE = 0.1  # метры

# Порог ресемплинга (эффективное количество частиц)
RESAMPLE_THRESHOLD = 0.5

# ============================================================================
# ПАРАМЕТРЫ ПЛАНИРОВАНИЯ ПУТИ (A*)
# ============================================================================

# Минимальный зазор от препятствий (метры)
OBSTACLE_CLEARANCE = 0.3

# Размер шага планирования (метры)
PLANNING_STEP_SIZE = 0.1

# Максимальное количество итераций A*
MAX_PLANNING_ITERATIONS = 10000

# ============================================================================
# ПАРАМЕТРЫ PID КОНТРОЛЛЕРА
# ============================================================================

# Коэффициенты PID для линейной скорости
PID_LINEAR_KP = 1.0
PID_LINEAR_KI = 0.0
PID_LINEAR_KD = 0.1

# Коэффициенты PID для угловой скорости
PID_ANGULAR_KP = 2.0
PID_ANGULAR_KI = 0.0
PID_ANGULAR_KD = 0.2

# ============================================================================
# ПАРАМЕТРЫ ЛОГИРОВАНИЯ
# ============================================================================

# Уровень логирования ('DEBUG', 'INFO', 'WARNING', 'ERROR', 'CRITICAL')
LOG_LEVEL = 'INFO'

# Путь к файлу лога
LOG_FILE = 'relaybot.log'

# Максимальный размер файла лога (байты)
LOG_MAX_SIZE = 10 * 1024 * 1024  # 10 MB

# Количество резервных копий лога
LOG_BACKUP_COUNT = 5

# ============================================================================
# ПАРАМЕТРЫ ВОССТАНОВЛЕНИЯ ПОСЛЕ ОШИБОК
# ============================================================================

# Максимальное количество попыток восстановления
MAX_RECOVERY_ATTEMPTS = 3

# Время ожидания между попытками восстановления (секунды)
RECOVERY_RETRY_DELAY = 2.0

# Максимальное время попытки восстановления (секунды)
MAX_RECOVERY_TIME = 60.0

# ============================================================================
# ПАРАМЕТРЫ ТАЙМАУТОВ СОСТОЯНИЙ
# ============================================================================

# Максимальное время в состоянии WAITING (секунды, 0 = без ограничений)
STATE_TIMEOUT_WAITING = 0

# Максимальное время в состоянии APPROACHING (секунды)
STATE_TIMEOUT_APPROACHING = 60.0

# Максимальное время в состоянии VERIFYING (секунды)
STATE_TIMEOUT_VERIFYING = 30.0

# Максимальное время в состоянии NAVIGATING_TO_WAREHOUSE (секунды)
STATE_TIMEOUT_NAVIGATING_TO_WAREHOUSE = 120.0

# Максимальное время в состоянии LOADING (секунды)
STATE_TIMEOUT_LOADING = 60.0

# Максимальное время в состоянии RETURNING_TO_CUSTOMER (секунды)
STATE_TIMEOUT_RETURNING_TO_CUSTOMER = 120.0

# Максимальное время в состоянии DELIVERING (секунды)
STATE_TIMEOUT_DELIVERING = 15.0

# Максимальное время в состоянии RESETTING (секунды)
STATE_TIMEOUT_RESETTING = 120.0

# Максимальное время в состоянии ERROR_RECOVERY (секунды)
STATE_TIMEOUT_ERROR_RECOVERY = 180.0

# ============================================================================
# ПАРАМЕТРЫ IR СЕНСОРА
# ============================================================================

# Минимальное расстояние для экстренной остановки (метры)
IR_EMERGENCY_STOP_DISTANCE = 0.1

# Расстояние для предупреждения о препятствии (метры)
IR_WARNING_DISTANCE = 0.3

# ============================================================================
# КОНСТАНТЫ
# ============================================================================

# Математические константы
PI = math.pi
TWO_PI = 2 * math.pi

# Преобразование градусов в радианы
DEG_TO_RAD = math.pi / 180.0

# Преобразование радианов в градусы
RAD_TO_DEG = 180.0 / math.pi
